<html>
  <head>
  </head>

  <body>
    <canvas id="canvas" width="640" height="480"></canvas>

    <script type="text/javascript" src="graphics.js"></script>
    <script type="text/javascript">
      "use strict"

      function shell (arr) {
        var i = arr.length,
            x, y, z, k

        while (i) {
          do {
            x = Math.random () - 0.5
            y = Math.random () - 0.5
            z = Math.random () - 0.5
            k = x * x + y * y + z * z
          } while (k > 0.25)

          k = 1 / Math.sqrt (k)

          arr[--i] = z * k
          arr[--i] = y * k
          arr[--i] = x * k
        }
      }

      var start = Date.now (),
          twoPi = 2 * Math.PI,
          sphere = new Float32Array (8192 * 3)

      shell (sphere)
      initialize (document.getElementById ("canvas"))

      setInterval (function () {
        var millis = Date.now () - start

        frame (function () {
          translate (0, 0, 4, function () {
            rotateY (millis * twoPi / 600000, function () {
              scale (65536, function () {
                /* How do you make 8192 points look like 65536? You flip them
                 * every which way! */
                plot (sphere)
                scale (-1, 1, 1, function () { plot (sphere) })
                scale (1, -1, 1, function () { plot (sphere) })
                scale (-1, -1, 1, function () { plot (sphere) })
                scale (1, 1, -1, function () { plot (sphere) })
                scale (-1, 1, -1, function () { plot (sphere) })
                scale (1, -1, -1, function () { plot (sphere) })
                scale (-1, -1, -1, function () { plot (sphere) })
              })

              rotateY (millis * twoPi / 15000, function () {
                plot (sphere)

                scale (1 + Math.sin (millis * twoPi / 1000) * 0.5, function () {
                  plot (sphere)
                })
              })
            })
          })
        })
      }, 1000 / 60)
    </script>
  </body>
</html>
