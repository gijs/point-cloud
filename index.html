<html>
  <head>
  </head>

  <body>
    <canvas id="canvas" width="640" height="480"></canvas>

    <script type="text/javascript" src="graphics.js"></script>
    <script type="text/javascript" src="models.js"></script>
    <script type="text/javascript">
      "use strict"

      /* FIXME: If we can *somehow* get back to using long array buffers for
       * storing everything, then I imagine we can get performance way up. The
       * main (only?) thing holding this back is the sort. This might not be so
       * bad if we only do partial sorts and we favor algorithms that spend
       * more time searching than swapping (selection sort?). */

      var start = Date.now (),
          stars = denseSphere (4096, 12, 0.015625, 127),
          planet = sparseSphere (2048, 1, 0.015625, 255),
          moon = sparseSphere (512, 0.5, 0.015625, 63)

      initialize (document.getElementById ("canvas"))
      add (stars)
      add (planet)
      add (moon)

      setInterval (function () {
        var now = Date.now (),
            millis = now - start

        frame (function () {
          translate (0, 0, 12, function () {
            rotateY (millis * Math.PI * 2 / 600000, function () {
              plot (stars)

              rotateY (millis * Math.PI * 2 / -30000, function () {
                translate (-4, 0, 0, function () {
                  plot (moon)
                })
              })

              rotateY (millis * Math.PI * 2 / -15000, function () {
                plot (planet)
              })
            })
          })
        })
      }, 1000 / 60)
    </script>
  </body>
</html>
